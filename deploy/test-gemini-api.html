<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        input[type="file"] {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Gemini API è¿æ¥æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ å½“å‰é…ç½®</h3>
            <div id="config-info"></div>
        </div>

        <div class="test-section">
            <h3>ğŸŒ API è¿é€šæ€§æµ‹è¯•</h3>
            <button onclick="testAPIConnectivity()">æµ‹è¯• API è¿æ¥</button>
            <div id="connectivity-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ–¼ï¸ å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</h3>
            <input type="file" id="test-image" accept="image/*">
            <button onclick="testImageUpload()">æµ‹è¯•å›¾ç‰‡ç”Ÿæˆ</button>
            <div id="image-log" class="log"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ å®Œæ•´ API è°ƒç”¨æµ‹è¯•</h3>
            <button onclick="testFullAPI()">å®Œæ•´æµ‹è¯•</button>
            <div id="full-log" class="log"></div>
        </div>
    </div>

    <script>
        // é…ç½®ä¿¡æ¯
        const CONFIG = {
            API_BASE_URL: 'https://api.tu-zi.com/v1',
            API_KEY: 'sk-3RNycSK4jptF86qmwtFAzYNiNAKEt0i1xNZZEufKs6OmU0Mm',
            MODEL_NAME: 'gemini-2.5-flash-image'
        };

        // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
        document.getElementById('config-info').innerHTML = `
            <div><strong>API Base URL:</strong> ${CONFIG.API_BASE_URL}</div>
            <div><strong>API Key:</strong> ${CONFIG.API_KEY.substring(0, 10)}...</div>
            <div><strong>Model Name:</strong> ${CONFIG.MODEL_NAME}</div>
        `;

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        // æµ‹è¯• API è¿é€šæ€§
        async function testAPIConnectivity() {
            const logId = 'connectivity-log';
            document.getElementById(logId).innerHTML = '';
            
            log(logId, 'å¼€å§‹æµ‹è¯• API è¿é€šæ€§...', 'info');
            
            // æµ‹è¯•ä¸åŒçš„ç«¯ç‚¹
            const endpoints = [
                '/chat/completions',
                '/v1/chat/completions',
                '/completions',
                '/v1/completions',
                '/images/generations',
                '/v1/images/generations'
            ];

            for (const endpoint of endpoints) {
                try {
                    log(logId, `æµ‹è¯•ç«¯ç‚¹: ${CONFIG.API_BASE_URL}${endpoint}`, 'info');
                    
                    const response = await fetch(`${CONFIG.API_BASE_URL}${endpoint}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${CONFIG.API_KEY}`
                        },
                        body: JSON.stringify({
                            model: CONFIG.MODEL_NAME,
                            messages: [{
                                role: 'user',
                                content: 'test'
                            }]
                        })
                    });

                    log(logId, `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, 
                        response.ok ? 'success' : 'error');
                    
                    if (response.ok) {
                        const data = await response.json();
                        log(logId, `âœ… ç«¯ç‚¹ ${endpoint} å¯ç”¨!`, 'success');
                        log(logId, `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`, 'info');
                        break;
                    }
                } catch (error) {
                    log(logId, `âŒ ç«¯ç‚¹ ${endpoint} é”™è¯¯: ${error.message}`, 'error');
                }
            }
        }

        // æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 
        async function testImageUpload() {
            const logId = 'image-log';
            const fileInput = document.getElementById('test-image');
            
            document.getElementById(logId).innerHTML = '';
            
            if (!fileInput.files[0]) {
                log(logId, 'è¯·å…ˆé€‰æ‹©ä¸€å¼ å›¾ç‰‡', 'error');
                return;
            }

            const file = fileInput.files[0];
            log(logId, `å¼€å§‹æµ‹è¯•å›¾ç‰‡: ${file.name} (${file.size} bytes)`, 'info');

            try {
                // è½¬æ¢ä¸º base64
                const base64 = await fileToBase64(file);
                log(logId, `å›¾ç‰‡è½¬æ¢ä¸º base64 æˆåŠŸ (${base64.length} å­—ç¬¦)`, 'success');

                // æµ‹è¯• API è°ƒç”¨
                const prompt = "å°†ä¸Šä¼ çš„äººåƒè½¬æ¢ä¸ºç¾å¼é£æ ¼çš„ä¸“ä¸š headshot";
                
                const requestBody = {
                    model: CONFIG.MODEL_NAME,
                    messages: [{
                        role: 'user',
                        content: [
                            {
                                type: 'text',
                                text: prompt
                            },
                            {
                                type: 'image_url',
                                image_url: {
                                    url: `data:${file.type};base64,${base64}`
                                }
                            }
                        ]
                    }],
                    max_tokens: 1000
                };

                log(logId, 'å‘é€ API è¯·æ±‚...', 'info');
                log(logId, `è¯·æ±‚ä½“å¤§å°: ${JSON.stringify(requestBody).length} å­—ç¬¦`, 'info');

                const response = await fetch(`${CONFIG.API_BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.API_KEY}`
                    },
                    body: JSON.stringify(requestBody)
                });

                log(logId, `API å“åº”: ${response.status} ${response.statusText}`, 
                    response.ok ? 'success' : 'error');

                const responseText = await response.text();
                log(logId, `å“åº”å†…å®¹: ${responseText}`, response.ok ? 'success' : 'error');

            } catch (error) {
                log(logId, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å®Œæ•´ API æµ‹è¯•
        async function testFullAPI() {
            const logId = 'full-log';
            document.getElementById(logId).innerHTML = '';
            
            log(logId, 'å¼€å§‹å®Œæ•´ API æµ‹è¯•...', 'info');
            
            // æµ‹è¯•æ‰€æœ‰å¯èƒ½çš„ API æ ¼å¼
            const testCases = [
                {
                    name: 'Chat Completions (æ–‡æœ¬)',
                    endpoint: '/chat/completions',
                    body: {
                        model: CONFIG.MODEL_NAME,
                        messages: [{
                            role: 'user',
                            content: 'ç”Ÿæˆä¸€å¼ ä¸“ä¸šå¤´åƒç…§ç‰‡'
                        }]
                    }
                },
                {
                    name: 'Images Generation',
                    endpoint: '/images/generations',
                    body: {
                        model: CONFIG.MODEL_NAME,
                        prompt: 'ä¸“ä¸šå¤´åƒç…§ç‰‡',
                        n: 1,
                        size: '512x512'
                    }
                },
                {
                    name: 'Completions',
                    endpoint: '/completions',
                    body: {
                        model: CONFIG.MODEL_NAME,
                        prompt: 'ç”Ÿæˆä¸€å¼ ä¸“ä¸šå¤´åƒç…§ç‰‡',
                        max_tokens: 100
                    }
                }
            ];

            for (const testCase of testCases) {
                try {
                    log(logId, `\næµ‹è¯•: ${testCase.name}`, 'info');
                    log(logId, `ç«¯ç‚¹: ${CONFIG.API_BASE_URL}${testCase.endpoint}`, 'info');
                    
                    const response = await fetch(`${CONFIG.API_BASE_URL}${testCase.endpoint}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${CONFIG.API_KEY}`
                        },
                        body: JSON.stringify(testCase.body)
                    });

                    log(logId, `çŠ¶æ€: ${response.status} ${response.statusText}`, 
                        response.ok ? 'success' : 'error');
                    
                    const responseText = await response.text();
                    log(logId, `å“åº”: ${responseText.substring(0, 200)}...`, 
                        response.ok ? 'success' : 'error');

                } catch (error) {
                    log(logId, `âŒ ${testCase.name} å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // æ–‡ä»¶è½¬ base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>